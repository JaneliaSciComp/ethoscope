

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>ethoscope package &mdash; ethoscope 1.0 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="ethoscope 1.0 documentation" href="index.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> ethoscope
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="ethoscope.core.html">ethoscope.core package</a></li>
<li class="toctree-l1"><a class="reference internal" href="ethoscope.roi_builders.html">ethoscope.roi_builder package</a></li>
<li class="toctree-l1"><a class="reference internal" href="ethoscope.trackers.html">ethoscope.trackers package</a></li>
<li class="toctree-l1"><a class="reference internal" href="ethoscope.stimulators.html">ethoscope.interactors package</a></li>
<li class="toctree-l1"><a class="reference internal" href="ethoscope.drawers.html">ethoscope.drawers package</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">ethoscope</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>ethoscope package</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/ethoscope.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="ethoscope-package">
<h1>ethoscope package<a class="headerlink" href="#ethoscope-package" title="Permalink to this headline">¶</a></h1>
<div class="section" id="subpackages">
<h2>Subpackages<a class="headerlink" href="#subpackages" title="Permalink to this headline">¶</a></h2>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="ethoscope.core.html">ethoscope.core package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="ethoscope.core.html#module-ethoscope.core">Module contents</a></li>
<li class="toctree-l2"><a class="reference internal" href="ethoscope.core.html#module-ethoscope.core.monitor">ethoscope.core.monitor module</a></li>
<li class="toctree-l2"><a class="reference internal" href="ethoscope.core.html#module-ethoscope.core.tracking_unit">ethoscope.core.tracking_unit module</a></li>
<li class="toctree-l2"><a class="reference internal" href="ethoscope.core.html#module-ethoscope.core.roi">ethoscope.core.roi module</a></li>
<li class="toctree-l2"><a class="reference internal" href="ethoscope.core.html#module-ethoscope.core.variables">ethoscope.core.variables module</a></li>
<li class="toctree-l2"><a class="reference internal" href="ethoscope.core.html#module-ethoscope.core.data_point">ethoscope.core.data_point module</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="ethoscope.drawers.html">ethoscope.drawers package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="ethoscope.drawers.html#submodules">Submodules</a></li>
<li class="toctree-l2"><a class="reference internal" href="ethoscope.drawers.html#module-ethoscope.drawers.drawers">ethoscope.drawers.drawers module</a></li>
<li class="toctree-l2"><a class="reference internal" href="ethoscope.drawers.html#module-ethoscope.drawers">Module contents</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="ethoscope.hardware.html">ethoscope.hardware package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="ethoscope.hardware.html#subpackages">Subpackages</a><ul>
<li class="toctree-l3"><a class="reference internal" href="ethoscope.hardware.input.html">ethoscope.hardware.input package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="ethoscope.hardware.input.html#submodules">Submodules</a></li>
<li class="toctree-l4"><a class="reference internal" href="ethoscope.hardware.input.html#module-ethoscope.hardware.input.cameras">ethoscope.hardware.input.cameras module</a></li>
<li class="toctree-l4"><a class="reference internal" href="ethoscope.hardware.input.html#module-ethoscope.hardware.input">Module contents</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="ethoscope.hardware.interfaces.html">ethoscope.hardware.interfaces package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="ethoscope.hardware.interfaces.html#submodules">Submodules</a></li>
<li class="toctree-l4"><a class="reference internal" href="ethoscope.hardware.interfaces.html#module-ethoscope.hardware.interfaces.interfaces">ethoscope.hardware.interfaces.interfaces module</a></li>
<li class="toctree-l4"><a class="reference internal" href="ethoscope.hardware.interfaces.html#module-ethoscope.hardware.interfaces.sleep_depriver_interface">ethoscope.hardware.interfaces.sleep_depriver_interface module</a></li>
<li class="toctree-l4"><a class="reference internal" href="ethoscope.hardware.interfaces.html#module-ethoscope.hardware.interfaces">Module contents</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="ethoscope.hardware.html#module-ethoscope.hardware">Module contents</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="ethoscope.stimulators.html">ethoscope.interactors package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="ethoscope.stimulators.html#module-ethoscope.stimulators">Module contents</a></li>
<li class="toctree-l2"><a class="reference internal" href="ethoscope.stimulators.html#module-ethoscope.stimulators.stimulators">ethoscope.stimulators.stimulators module</a></li>
<li class="toctree-l2"><a class="reference internal" href="ethoscope.stimulators.html#module-ethoscope.stimulators.sleep_depriver_stimulators">ethoscope.stimulators.sleep_depriver_stimulators module</a></li>
<li class="toctree-l2"><a class="reference internal" href="ethoscope.stimulators.html#module-ethoscope.stimulators.odour_stimulators">ethoscope.stimulators.odour_stimulators module</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="ethoscope.trackers.html">ethoscope.trackers package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="ethoscope.trackers.html#module-ethoscope.trackers">Module contents</a></li>
<li class="toctree-l2"><a class="reference internal" href="ethoscope.trackers.html#module-ethoscope.trackers.trackers">ethoscope.trackers.trackers module</a></li>
<li class="toctree-l2"><a class="reference internal" href="ethoscope.trackers.html#module-ethoscope.trackers.single_roi_tracker">ethoscope.trackers.single_roi_tracker module</a></li>
<li class="toctree-l2"><a class="reference internal" href="ethoscope.trackers.html#module-ethoscope.trackers.adaptive_bg_tracker">ethoscope.trackers.adaptive_bg_tracker module</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="ethoscope.utils.html">ethoscope.utils package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="ethoscope.utils.html#module-ethoscope.utils">Module contents</a></li>
<li class="toctree-l2"><a class="reference internal" href="ethoscope.utils.html#module-ethoscope.utils.debug">ethoscope.utils.debug module</a></li>
<li class="toctree-l2"><a class="reference internal" href="ethoscope.utils.html#module-ethoscope.utils.description">ethoscope.utils.description module</a></li>
<li class="toctree-l2"><a class="reference internal" href="ethoscope.utils.html#module-ethoscope.utils.img_proc">ethoscope.utils.img_proc module</a></li>
<li class="toctree-l2"><a class="reference internal" href="ethoscope.utils.html#module-ethoscope.utils.io">ethoscope.utils.io module</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="ethoscope.web_utils.html">ethoscope.web_utils package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="ethoscope.web_utils.html#submodules">Submodules</a></li>
<li class="toctree-l2"><a class="reference internal" href="ethoscope.web_utils.html#module-ethoscope.web_utils.control_thread">ethoscope.web_utils.control_thread module</a></li>
<li class="toctree-l2"><a class="reference internal" href="ethoscope.web_utils.html#module-ethoscope.web_utils.helpers">ethoscope.web_utils.helpers module</a></li>
<li class="toctree-l2"><a class="reference internal" href="ethoscope.web_utils.html#module-ethoscope.web_utils.record">ethoscope.web_utils.record module</a></li>
<li class="toctree-l2"><a class="reference internal" href="ethoscope.web_utils.html#module-ethoscope.web_utils">Module contents</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="section" id="module-ethoscope">
<span id="module-contents"></span><h2>Module contents<a class="headerlink" href="#module-ethoscope" title="Permalink to this headline">¶</a></h2>
<p>Ethoscope is a platform developed at <a class="reference external" href="http://lab.gilest.ro/">Gilestro lab</a>.
It provide an integrated set of tools to acquire behavioural data on small animals and build feed back modules to interact with them in real time.
A description of the whole system is available on its <a class="reference external" href="http://gilestrolab.github.io/ethoscope/">website</a>
The documentation herein describes the ethoscope python package, which is the core of the device software.
It is intended for programmers who want to contribute to development, and assumes familiarity with <code class="docutils literal"><span class="pre">python</span></code> programming language.</p>
<p>The first purpose of the package is to provide biologists with a modular API to acquire videos, track animals in real time, feed back to
deliver stimuli upon specific triggers, annotate video frames with tracking information and save data in a consistent format (database).
In addition, is implements a webserver that can run a a daemon and performs actions upon POST requests.</p>
<div class="section" id="installation">
<h3>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h3>
<p>Probably you want to work on a virtual environment.
Then you want to install OpenCV (which is an external library &#8211; i.e. not ip pip).
Afterwards, you can clone the repository (the branch <code class="docutils literal"><span class="pre">dev</span></code> being the development version) and run:</p>
<p><code class="docutils literal"><span class="pre">`</span>
<span class="pre">cd</span> <span class="pre">src</span>
<span class="pre">pip</span> <span class="pre">install</span> <span class="pre">-e</span> <span class="pre">.[dev]</span>
<span class="pre">`</span></code></p>
</div>
<div class="section" id="core-api">
<h3>Core API<a class="headerlink" href="#core-api" title="Permalink to this headline">¶</a></h3>
<p>This diagram represents the core of the API in UML:</p>
<img src="_images/uml_diagram.svg" /><p>The classes prefixed with <code class="docutils literal"><span class="pre">Base</span></code> are abstract, and several derived classes are already implemented for most of them, but more can be done
in the prospect of achieving modularity.</p>
</div>
<div class="section" id="local-tracking-example">
<h3>Local tracking example<a class="headerlink" href="#local-tracking-example" title="Permalink to this headline">¶</a></h3>
<p>Since the API is modular, it can be used to simply perform of line tracking from a video file.
Here is a very simple example.
If you want to run this code yourself, you can download the <a class="reference external" href="http://gilestrolab.github.io/ethoscope/data/test_video.mp4">test video</a>.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># We import all the bricks from ethoscope package</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ethoscope.core.monitor</span> <span class="k">import</span> <span class="n">Monitor</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ethoscope.trackers.adaptive_bg_tracker</span> <span class="k">import</span> <span class="n">AdaptiveBGModel</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ethoscope.utils.io</span> <span class="k">import</span> <span class="n">SQLiteResultWriter</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ethoscope.hardware.input.cameras</span> <span class="k">import</span> <span class="n">MovieVirtualCamera</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ethoscope.drawers.drawers</span> <span class="k">import</span> <span class="n">DefaultDrawer</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># You can also load other types of ROI builder. This one is for 20 tubes (two columns of ten rows)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ethoscope.roi_builders.target_roi_builder</span> <span class="k">import</span> <span class="n">SleepMonitorWithTargetROIBuilder</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># change these three variables according to how you name your input/output files</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">INPUT_VIDEO</span> <span class="o">=</span> <span class="s2">&quot;test_video.mp4&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">OUTPUT_VIDEO</span> <span class="o">=</span> <span class="s2">&quot;/tmp/my_output.avi&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">OUTPUT_DB</span> <span class="o">=</span> <span class="s2">&quot;/tmp/results.db&quot;</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># We use a video input file as if it was a &quot;camera&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cam</span> <span class="o">=</span> <span class="n">MovieVirtualCamera</span><span class="p">(</span><span class="n">INPUT_VIDEO</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># here, we generate ROIs automatically from the targets in the images</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">roi_builder</span> <span class="o">=</span> <span class="n">SleepMonitorWithTargetROIBuilder</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rois</span> <span class="o">=</span> <span class="n">roi_builder</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">cam</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Then, we go back to the first frame of the video</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cam</span><span class="o">.</span><span class="n">restart</span><span class="p">()</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># we use a drawer to show inferred position for each animal, display frames and save them as a video</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">drawer</span> <span class="o">=</span> <span class="n">DefaultDrawer</span><span class="p">(</span><span class="n">OUTPUT_VIDEO</span><span class="p">,</span> <span class="n">draw_frames</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># We build our monitor</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">monitor</span> <span class="o">=</span> <span class="n">Monitor</span><span class="p">(</span><span class="n">cam</span><span class="p">,</span> <span class="n">AdaptiveBGModel</span><span class="p">,</span> <span class="n">rois</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Now everything ius ready, we run the monitor with a result writer and a drawer</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">SQLiteResultWriter</span><span class="p">(</span><span class="n">OUTPUT_DB</span><span class="p">,</span> <span class="n">rois</span><span class="p">)</span> <span class="k">as</span> <span class="n">rw</span><span class="p">:</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">monitor</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">rw</span><span class="p">,</span><span class="n">drawer</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="post-hock-data-analysis">
<h3><em>Post hock</em> data analysis<a class="headerlink" href="#post-hock-data-analysis" title="Permalink to this headline">¶</a></h3>
<p>A large amount of data can be generated thanks to ethoscope.
In order to render the analysis (visualisation, summaries, statistics ...)  straightforward and flexible,
we developed an <code class="docutils literal"><span class="pre">R</span></code> package named <a class="reference external" href="https://github.com/gilestrolab/rethomics">rethomics</a>.</p>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Quentin Geissmann.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'1.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>